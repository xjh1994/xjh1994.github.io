<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>【ASP】卡片游戏</title>
  <meta name="description" content="[php]VERSION 5.00Begin VB.Form TestForm1   Caption         =   “TestForm1”   ClientHeight    =   6555   ClientLeft      =   60   ClientTop       =   345   Cl...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.xjh1994.com/asp.net/2013/04/23/e3-80-90asp-e3-80-91-e5-8d-a1-e7-89-87-e6-b8-b8-e6-88-8f.html">
  <link rel="alternate" type="application/rss+xml" title="X的博客" href="http://www.xjh1994.com/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">X的博客</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/works/">Works</a>
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">【ASP】卡片游戏</h1>
    <p class="post-meta"><time datetime="2013-04-23T20:39:23+08:00" itemprop="datePublished">Apr 23, 2013</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">xjh1994</span></span></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>[php]
VERSION 5.00
Begin VB.Form TestForm1
   Caption         =   “TestForm1”
   ClientHeight    =   6555
   ClientLeft      =   60
   ClientTop       =   345
   ClientWidth     =   10560
   LinkTopic       =   “Form1”
   ScaleHeight     =   6555
   ScaleWidth      =   10560
   StartUpPosition =   2  ‘屏幕中心
   Begin VB.TextBox Text1
      Height          =   5295
      Left            =   8040
      MultiLine       =   -1  ‘True
      TabIndex        =   6
      Text            =   “TestForm1.frx”:0000
      Top             =   480
      Width           =   2415
   End
   Begin VB.CommandButton Command1
      Caption         =   “Command1”
      Height          =   495
      Index           =   5
      Left            =   7320
      TabIndex        =   5
      Top             =   6000
      Width           =   1215
   End
   Begin VB.CommandButton Command1
      Caption         =   “Command1”
      Height          =   495
      Index           =   4
      Left            =   5880
      TabIndex        =   4
      Top             =   6000
      Width           =   1215
   End
   Begin VB.CommandButton Command1
      Caption         =   “Command1”
      Height          =   495
      Index           =   3
      Left            =   4440
      TabIndex        =   3
      Top             =   6000
      Width           =   1215
   End
   Begin VB.CommandButton Command1
      Caption         =   “Command1”
      Height          =   495
      Index           =   2
      Left            =   3000
      TabIndex        =   2
      Top             =   6000
      Width           =   1215
   End
   Begin VB.CommandButton Command1
      Caption         =   “Command1”
      Height          =   495
      Index           =   1
      Left            =   1560
      TabIndex        =   1
      Top             =   6000
      Width           =   1215
   End
   Begin VB.CommandButton Command1
      Caption         =   “Command1”
      Height          =   495
      Index           =   0
      Left            =   120
      TabIndex        =   0
      Top             =   6000
      Width           =   1215
   End
   Begin VB.Timer Timer1
      Interval        =   1000
      Left            =   8400
      Top             =   6000
   End
   Begin VB.Label Label3
      Caption         =   “HP”
      Height          =   255
      Index           =   5
      Left            =   6360
      TabIndex        =   15
      Top             =   3720
      Width           =   1215
   End
   Begin VB.Label Label3
      Caption         =   “SP”
      Height          =   255
      Index           =   4
      Left            =   6360
      TabIndex        =   14
      Top             =   4080
      Width           =   1215
   End
   Begin VB.Label Label3
      Caption         =   “HP”
      Height          =   255
      Index           =   3
      Left            =   3600
      TabIndex        =   13
      Top             =   3720
      Width           =   1215
   End
   Begin VB.Label Label3
      Caption         =   “SP”
      Height          =   255
      Index           =   2
      Left            =   3600
      TabIndex        =   12
      Top             =   4080
      Width           =   1215
   End
   Begin VB.Label Label3
      Caption         =   “SP”
      Height          =   255
      Index           =   1
      Left            =   840
      TabIndex        =   11
      Top             =   4080
      Width           =   1215
   End
   Begin VB.Label Label3
      Caption         =   “HP”
      Height          =   255
      Index           =   0
      Left            =   840
      TabIndex        =   10
      Top             =   3720
      Width           =   1215
   End
   Begin VB.Label Label2
      Caption         =   “SP”
      Height          =   255
      Index           =   1
      Left            =   3480
      TabIndex        =   9
      Top             =   2040
      Width           =   1215
   End
   Begin VB.Label Label2
      Caption         =   “HP”
      Height          =   255
      Index           =   0
      Left            =   3480
      TabIndex        =   8
      Top             =   1800
      Width           =   1215
   End
   Begin VB.Line Line1
      BorderWidth     =   2
      Visible         =   0   ‘False
      X1              =   360
      X2              =   720
      Y1              =   120
      Y2              =   120
   End
   Begin VB.Label Label1
      Caption         =   “系统状态”
      Height          =   375
      Left            =   8040
      TabIndex        =   7
      Top             =   120
      Width           =   2415
   End
   Begin VB.Shape Shape4
      FillColor       =   &amp;H0000FF00&amp;
      FillStyle       =   0  ‘Solid
      Height          =   135
      Left            =   840
      Top             =   5520
      Visible         =   0   ‘False
      Width           =   1215
   End
   Begin VB.Shape Shape2
      FillStyle       =   0  ‘Solid
      Height          =   1095
      Index           =   2
      Left            =   6360
      Top             =   4320
      Width           =   1215
   End
   Begin VB.Shape Shape2
      FillStyle       =   0  ‘Solid
      Height          =   1095
      Index           =   1
      Left            =   3600
      Top             =   4320
      Width           =   1215
   End
   Begin VB.Shape Shape3
      FillColor       =   &amp;H00C0FFFF&amp;
      FillStyle       =   0  ‘Solid
      Height          =   255
      Left            =   0
      Top             =   0
      Visible         =   0   ‘False
      Width           =   255
   End
   Begin VB.Shape Shape2
      FillStyle       =   0  ‘Solid
      Height          =   1095
      Index           =   0
      Left            =   840
      Top             =   4320
      Width           =   1215
   End
   Begin VB.Shape Shape1
      BackColor       =   &amp;H000000FF&amp;
      BorderColor     =   &amp;H000000FF&amp;
      FillColor       =   &amp;H000000FF&amp;
      FillStyle       =   0  ‘Solid
      Height          =   1095
      Left            =   3480
      Top             =   600
      Width           =   1215
   End
End
Attribute VB_Name = “TestForm1”
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Private Declare Sub Sleep Lib “kernel32” (ByVal dwMilliseconds As Long)</p>

<p>Private Type wAction
    strAttack As String
    strMagic As String
    strbility As String
    strBack As String
    strOption As String
    strRunAWay As String
    strType As String
    intModel As Integer
End Type
Private Type WFang
    strName As String
    intHP As Integer
    intSP As Integer
    intHPC As Integer
    intSPC As Integer
End Type</p>

<p>Private Type DFang
    intDHP As Integer
    intDSP As Integer
    intDCHP As Integer
    intDCSP As Integer
    strName As String
End Type</p>

<p>Dim boolW As Boolean, boolD As Boolean ‘布尔值，设置当前状态下，哪一方开始动作
Dim boolWDone As Boolean, boolDDone As Boolean, boolALLWDone As Boolean ‘布尔值，判断当前图标是否已经动作完成。和我方所有图标的动作是否完成。
Dim boolWAttackNow As Boolean ‘布尔值，表示我方进入战斗动画播放界面。
Dim DMinJie As Integer, WMinJie As Integer ‘敌我双方的敏捷
Dim intCurrentW As Integer ‘当前动作的图标
Dim WElements() As wAction ‘初始化屏幕上三个战斗图标
Dim strStateText As String ‘当前状态的文字描述
Dim eWFang() As WFang
Dim eDFang As DFang</p>

<p>Private Sub Command1_Click(Index As Integer)
‘</p>

<div class="highlighter-rouge"><pre class="highlight"><code>boolWDone = False

Select Case Index
    Case 0 '攻击
        Call FAttackW(intCurrentW, "GONGJI")
    Case 1 '魔法

    Case 2 '技能

    Case 3 '回避

    Case 4 '选项

    Case 5 '逃跑

    Case Else

End Select

Call refreshState
Call closeAllButtom End Sub
</code></pre>
</div>

<p>Private Sub Form_Load()
‘
    Call initData1      ‘初始化部分用于测试的数值
    Call initData2</p>

<p>End Sub</p>

<p>Private Sub Timer1_Timer()
‘</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Call updateDF1  '更新敌方的位子移动
Call updateWF1  '更新我方的位置移动

Call checkWhoAttack '确定哪一方可以攻击
Call updateAttackW
Call fightNowW
</code></pre>
</div>

<p>End Sub</p>

<p>Private Sub updateDF1()
‘</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Call refreshPOS
</code></pre>
</div>

<p>End Sub
Private Sub updateWF1()
‘</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Call refreshWPOS
</code></pre>
</div>

<p>End Sub
Private Sub refreshWPOS()
‘
    Dim l1 As Long, l2 As Long, l3 As Long
    Dim i1 As Integer
    Dim d1 As Double
    d1 = Rnd</p>

<div class="highlighter-rouge"><pre class="highlight"><code>d1 = d1 * 10
l1 = d1
l2 = d1 * 100
For i1 = 0 To Me.Shape2.UBound
    Select Case l1
        Case Is &gt;= 8
            Call SMove(Me.Shape2(i1), "left", l2)
        Case Is &gt;= 5
            Call SMove(Me.Shape2(i1), "right", l2)
        Case Is &gt;= 2
            Call SMove(Me.Shape2(i1), "top", l2)
        Case Is &gt;= 0
            Call SMove(Me.Shape2(i1), "buttom", l2)
        Case Else

    End Select
Next i1 End Sub Private Sub refreshPOS() '
Dim l1 As Long, l2 As Long, l3 As Long
Dim d1 As Double
d1 = Rnd

d1 = d1 * 10
l1 = d1
l2 = d1 * 100
l3 = d1 * 10 '    Debug.Print l3 '    Debug.Print l2
Select Case l1
    Case Is &gt;= 8 '            Debug.Print "XIA"
        Me.Shape1.Top = Me.Shape1.Top + l3
        Sleep (l2)
        Me.Shape1.Top = Me.Shape1.Top - l3
    Case Is &gt;= 5 '            Debug.Print "SHANG"
        Me.Shape1.Top = Me.Shape1.Top - l3
        Sleep (l2)
        Me.Shape1.Top = Me.Shape1.Top + l3
    Case Is &gt;= 2 '            Debug.Print "ZUO"
        Me.Shape1.Left = Me.Shape1.Left - l3
        Sleep (l2)
        Me.Shape1.Left = Me.Shape1.Left + l3
    Case Is &gt;= 0 '            Debug.Print "YOU"
        Me.Shape1.Left = Me.Shape1.Left + l3
        Sleep (l2)
        Me.Shape1.Left = Me.Shape1.Left - l3
    Case Else '            Debug.Print l1
End Select

Me.Refresh
</code></pre>
</div>

<p>End Sub</p>

<p>Private Sub SMove(ByRef Sp1 As Shape, strTmp1 As String, lTime As Long)
‘
    Dim llength As Long
    llength = lTime / 10</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Select Case strTmp1
    Case "left"
        Sp1.Left = Sp1.Left - llength
        Sleep (lTime)
        Sp1.Left = Sp1.Left + llength
    Case "right"
        Sp1.Left = Sp1.Left + llength
        Sleep (lTime)
        Sp1.Left = Sp1.Left - llength
    Case "top"
        Sp1.Top = Sp1.Top - llength
        Sleep (lTime)
        Sp1.Top = Sp1.Top + llength
    Case "buttom"
        Sp1.Top = Sp1.Top + llength
        Sleep (lTime)
        Sp1.Top = Sp1.Top - llength
    Case Else

End Select
</code></pre>
</div>

<p>End Sub</p>

<p>’—————————————————————-
‘检查此时段是我方可以战斗了，还是敌方战斗。
Private Sub checkWhoAttack()
‘
    If boolWAttackNow = True Then
        Exit Sub
    End If</p>

<div class="highlighter-rouge"><pre class="highlight"><code>If boolALLWDone = True Or boolWDone = True Then '表示我方还处在战斗当中
    Exit Sub
ElseIf boolDDone = True Then    '敌方进入战斗状态
    strStateText = ""
    Call refreshState
    Call closeAllButtom
    Exit Sub
End If

If DMinJie &gt; WMinJie Then '战斗开始界面，判断哪一方的敏捷度高，哪一方开始攻击。
    boolD = True
    Me.Shape4.Visible = False
    intCurrentW = 0
    boolDDone = True
Else
    boolW = True
    Me.Shape4.Visible = True
    boolALLWDone = True
    boolWDone = False
    Call openAllButtom
End If
</code></pre>
</div>

<p>End Sub</p>

<p>Private Sub initData1()
‘
    DMinJie = 1
    WMinJie = 5
    boolD = False
    boolW = False
    boolWDone = False
    boolDDone = False
    boolALLWDone = False
    boolWAttackNow = False
    Call closeAllButtom</p>

<p>End Sub</p>

<p>Private Sub initData2()
‘
    Dim i1 As Integer
    ReDim WElements(3)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ReDim eWFang(3)

For i1 = 0 To UBound(eWFang) - 1
    With eWFang(i1)
        .intHP = 1000
        .intHPC = 1000
        .intSP = 500
        .intSPC = 500
        .strName = "我方卡片：" + CStr(i1)
    End With
Next i1
</code></pre>
</div>

<p>End Sub</p>

<p>Private Sub FAttackW(intCurrentW1 As Integer, strAttack As String)
‘</p>

<div class="highlighter-rouge"><pre class="highlight"><code>WElements(intCurrentW1).strType = strAttack

Select Case strAttack
    Case "GONGJI"
        WElements(intCurrentW1).intModel = 0
        strStateText = strStateText + "Shape:" + CStr(intCurrentW1) + ", " + strAttack + vbCrLf
    Case Else

End Select
boolWDone = True
</code></pre>
</div>

<p>End Sub</p>

<p>’———————————————–
‘判断我方的所有队员是否全都攻击完毕,如没有攻击完毕，则进入下个队员的动作选择。
Private Sub updateAttackW()
‘
    If boolWDone = True Then
        intCurrentW = intCurrentW + 1
        If intCurrentW &gt; 2 Then
            boolWDone = False
            Me.Shape4.Visible = False
            boolWAttackNow = True
            boolALLWDone = False
            Exit Sub
        End If
        Me.Shape4.Left = Me.Shape2(intCurrentW).Left
        Call openAllButtom
        boolWDone = False
    End If</p>

<p>End Sub</p>

<p>Private Sub refreshState()
‘
    Me.Text1.Text = “”
    strStateText = strStateText + vbCrLf + “intCurrentW:” + CStr(intCurrentW) + vbCrLf</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Me.Text1.Text = strStateText
</code></pre>
</div>

<p>End Sub</p>

<p>Private Sub closeAllButtom()
‘
    Dim i1 As Integer</p>

<div class="highlighter-rouge"><pre class="highlight"><code>For i1 = 0 To Me.Command1.UBound
    Me.Command1(i1).Enabled = False

Next i1 End Sub
</code></pre>
</div>

<p>Private Sub openAllButtom()
‘
    Dim i1 As Integer</p>

<div class="highlighter-rouge"><pre class="highlight"><code>For i1 = 0 To Me.Command1.UBound
    Me.Command1(i1).Enabled = True

Next i1 End Sub
</code></pre>
</div>

<p>Private Sub fightNowW()
‘
    Dim i1 As Integer
‘    If boolWAttackNow = True Then
‘        MsgBox “开始战斗动画的播放”
‘        boolWAttackNow = False
‘        Me.Timer1.Enabled = False
‘    End If</p>

<div class="highlighter-rouge"><pre class="highlight"><code>If boolWAttackNow = False Then
    Exit Sub
End If
</code></pre>
</div>

<p>’    MsgBox “开始战斗动画的播放”
    strStateText = strStateText + “开始战斗动画的播放” + vbCrLf
    boolWAttackNow = False
    Me.Timer1.Enabled = False
    Call refreshState</p>

<div class="highlighter-rouge"><pre class="highlight"><code>For i1 = 0 To UBound(WElements) - 1
    Call attackShape(Shape2(i1))
Next i1

strStateText = strStateText + "我方战斗完成"
Call refreshState
Me.Timer1.Enabled = True
boolDDone = True End Sub
</code></pre>
</div>

<p>Private Sub attackShape(ByRef Shape1 As Shape)
‘</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Shape1.Top = Shape1.Top - (Shape1.Height / 2) '    Sleep (1000)

Call AdrawLineW(Shape1.Top, Shape1.Left, Shape1.Width)   '画出攻击线
</code></pre>
</div>

<p>’    Sleep (1000)
    Shape1.Top = Shape1.Top + (Shape1.Height / 2)
    Me.Line1.Visible = False</p>

<p>End Sub</p>

<p>Private Sub AdrawLineW(intY As Integer, intX As Integer, intWidth As Integer)
‘
    Me.Line1.Visible = True
    With Me.Line1
        .X1 = intX + (intWidth / 2)
        .X2 = Me.Shape1.Left + (Me.Shape1.Width / 2)
        .Y1 = intY
        .Y2 = Me.Shape1.Top + Me.Shape1.Height
    End With
    Me.Line1.BorderWidth = 5
    Me.Refresh
    Sleep (1000)
‘    Me.Line1.Visible = False</p>

<p>End Sub
[/php]</p>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">X的博客</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>X的博客</li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/xjh1994"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">xjh1994</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>技术改变世界
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
